# 机器数（signed number representation) 和 真值
**机器需要给数字编码来处理符号（负数）的问题**

以8位, 原码为例（1 byte):

*   3  -> 00000011,    3是00000011的真值， 00000011是3的机器数
*   -3 -> 10000011,    -3是10000011的真值， 10000011是-3的机器数

# 原码 sign-and-magnitude
**最高位(most significant bit)表示符号，0为正数，1为负数。其余位是绝对值**

* [X]原 = X （ 0 <= X < 2 ^ (n-1) )
* [X]原 = 2 ^ (n-1) - X (-2 ^ (n-1) < X <= 0)

* [+1]原 = 0000 0001
* [-1]原 = 1000 0001

以8位为例，范围是[-127, 127]

存在+0和-0 ->  00000000 & 10000000

# 反码 ones' complement
**最高位表示符号， 负数 = 按位非 对应的正数 = 原码的基础上符号位不变，其余位取反**

* [X]反 = X （ 0 <= X < 2 ^ (n-1) )
* [X]反 = 2 ^ n - 1 + X  (-2 ^ (n-1) < X <= 0)
  * （-X）+（[X]反）= 11111111   -> X[反] = 2^n-1 + X

* [+1]反 = [00000001]
* [-1]反 = [11111110] = 11111111 + -1

存在+0和-0 ->   00000000 & 11111111

# 补码 two's complement
**最高位表示符号， 补码 = 反码 + 1**

* [X]补 = X （ 0 <= X < 2 ^ (n-1) )
* [X]补 = 2 ^ n + X  (-2 ^ (n-1) <= X <= 0)
  * （-X）+（[X]补）= 100000000（2 ^ n)   -> X[补] = 2^n + X

* [+1]补 = [00000001]
* [-1]补 = [11111111] = 100000000 + -1  

只有一个0 -> 00000000 (0的补码还是0，最高位溢出)

多了一个-128 [10000000] (没有对应的+128)

# 为何需要反码或补码
**如果用原码进行计算，需要让计算机的电路去理解符号位。为了避免这种复杂性，人们想让符号位也参与到运算中**
**减一个正数 = 加一个负数**

如果使用原码，将会得到错误的结果：

> 1 - 1 = 1 + (-1) = [00000001]原 + [10000001]原 = [10000010]原 = -2

然而，反码会解决这个问题，但却需要考虑进位/借位(carry/borrow)

>
* 3 - 2 = 3 + (-2) = [0000 0011]反 + [1111 1101]反 = [0000 0000]反 + 进位 1 = 0 + 1 = 1
* 3 - 4 = 3 + (-4) = [0000 0011]反 + [1111 1011]反 = [1111 1110]反 + 进位 0 = -1
* -2 + -3 = [1111 1101]反 + [1111 1100]反 = [1111 1001]反 + 进位 1 = -6 + 1 = -5

然而，补码是可以直接计算的

>
* 3 + (-2) = [0000 0011]补 + [1111 1110]补 = [0000 0001]补 = 1
* 3 + (-4) = [0000 0011]补 + [1111 1100]补 = [1111 1111]补 = -1

## 数学本质
**位溢出的本质就是同余（mod）**
**理想的编码可以做到 （X1 + X2)编 = X1编 + X2编**

补码达到了理想的效果, 因为它的数学本质是给负数加了 2^n, 而2^n是1[0000,0000], 相当于完全溢出。
这样很好证明: (X1 + X2)补 = X1补 + X2补。以X1 + X2 > 0 & X1 >0 & X2 <0 为例：

>
* (X1 + X2)补 = X1 + X2
* X1补 + X2补 = X1 + 2^n + X2
* 而 X1 + X2 是一定等于 X1 + 2^n + X2

但是反码的数学本质是给负数加了个2^n-1。 也就增加了进位的复杂性。

# 引用
- https://en.wikipedia.org/wiki/Binary_number
- https://en.wikipedia.org/wiki/Signed_number_representations
- http://www.cnblogs.com/zhangziqiu/archive/2011/03/30/ComputerCode.html
- https://zh.wikipedia.org/wiki/%E5%8E%9F%E7%A0%81
- https://zh.wikipedia.org/wiki/%E4%B8%80%E8%A3%9C%E6%95%B8
- http://www.ruanyifeng.com/blog/2009/08/twos_complement.html
